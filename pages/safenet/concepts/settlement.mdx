# Settlement

**Settlement:** process by which a processor debits funds from a Safenet account in order to repay the liquidity provider for the short-term loan (pre-fund) from the Safenet action.


The settlement engine is responsible for processing debit requests on the debit chain. That is, it will eventually transfer funds from a Safenet Safe to a beneficiary chosen by the liquidity provider that fronted funds on the spending chain.

Upon settlement, it will start a delay period in which validators can check settlement correctness and challenge the settlement if they find that it is invalid. In the case where there is no challenge during the settlement delay, the processor can execute the settlement which will trigger the debiting of the Safe and transfer the funds from the account to a beneficiary to reimburse the liquidity provider that fronted the funds. The liquidity provision and relayer fees are included in the debiting.

In case a validator does find something wrong with the settlement, it can start a cross-chain challenge flow. For this flow:

1. The challenger will execute a transaction to the settlement engine to start a challenge on the debit chain with a challenge delay. Note that this delay is separate from the settlement delay, and represents how much time the processor has to prove correctness of the settlement. As long as a challenge is on-going, the settlement cannot be executed.
2. The processor is required to send information from the spend chain, where the Safenet transaction actually executed, to the home chain in order to prove correctness of the settlement there.
3. The processor will prove the settlement to the guarantee engine on the home chain, which will send a message indicating that correctness is proven to the settlement contract on the debit chain.
    - Once the message is received by the settlement engine, the settlement is considered valid and can be executed right way to trigger the debit of the Safe (i.e. the settlement delay is waived).
    - In case the processor is unable to prove correctness of the settlement, the settlement contract will never receive a message from the guarantee engine, and the challenge delay will timeout. At this point, the settlement is considered invalid and **can never again be executed**.


### Happy Flow

![Safenet-settlement-happy-flow](../../../assets/safenet-settlement-happy-flow.png)



### Sad Flow

![Safenet-settlement-sad-flow](../../../assets/safenet-settlement-sad-flow.png)

### Correctness Proof

![Safenet-settlement-correctness-proof](../../../assets/safenet-settlement-correctness-proof.png)